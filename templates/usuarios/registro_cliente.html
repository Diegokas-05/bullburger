{% extends 'base.html' %}
{% load static %}

{% block title %}Registro - BullBurger{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="auth-container">
    <div class="auth-image">
        <img src="/static/img/fondo_del_registre.jpg" alt="BullBurger Experiencia" />
        <div class="overlay-text">
            <h2>칔nete a <span>BullBurger</span></h2>
            <p>Donde cada mordida cuenta una historia 游꼢</p>
        </div>
    </div>

    <div class="auth-form">
        <div class="center-wrapper">
            
            <div class="auth-header">
                <h1 class="logo">Bull<span>Burger</span></h1>
                <p class="subtitle">Crea tu cuenta y disfruta el sabor</p>

                <div class="tabs">
                    <div class="tab active">Reg칤strate</div>
                    <a href="{% url 'login' %}" class="tab">Iniciar sesi칩n</a>
                </div>
            </div>

            <form method="post" class="form-content" id="registerForm" novalidate>
                {% csrf_token %}
                
                <div class="form-group">
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" name="nombre" id="nombre" placeholder="Nombre completo" 
                           value="{{ form.nombre.value|default:'' }}" required>
                    <div class="error-message" id="nombreError"></div>
                </div>

                <div class="form-group">
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" name="email" id="email" placeholder="Correo electr칩nico" 
                           value="{{ form.email.value|default:'' }}" required>
                    <div class="error-message" id="emailError"></div>
                </div>

                <div class="form-group">
                    <i class="fas fa-phone input-icon"></i>
                    <input type="tel" name="telefono" id="telefono" placeholder="Tel칠fono (Ej: 1234-5678)" 
                           value="{{ form.telefono.value|default:'' }}">
                    <div class="error-message" id="telefonoError"></div>
                </div>

                <div class="form-group">
                    <i class="fas fa-map-marker-alt input-icon" style="top: 50%; transform: translateY(-50%);"></i>
                    <input type="text" name="direccion" id="direccion" placeholder="Direcci칩n de entrega (opcional)" 
                           value="{{ form.direccion.value|default:'' }}">
                    <div class="error-message" id="direccionError"></div>
                </div>

                <div class="form-group">
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" name="password1" id="password1" placeholder="Crea una contrase침a" 
                           required minlength="8">
                    <div class="error-message" id="password1Error"></div>
                </div>

                <div class="form-group">
                    <i class="fas fa-check-circle input-icon"></i>
                    <input type="password" name="password2" id="password2" placeholder="Confirma tu contrase침a" 
                           required>
                    <div class="error-message" id="password2Error"></div>
                </div>

                <button type="submit" class="btn-submit">
                    Crear Cuenta <i class="fas fa-arrow-right" style="margin-left:8px;"></i>
                </button>
            </form>
            
        </div>
    </div>
</div>

<div id="customAlert" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="alertTitle">T칤tulo</h2>
            <span class="close" onclick="closeCustomAlert()">&times;</span>
        </div>
        <div class="modal-body">
            <p id="alertMessage">Mensaje</p>
            <div class="form-actions">
                <button class="btn-save" id="alertConfirmBtn">Entendido</button>
            </div>
        </div>
    </div>
</div>

<style>
/* --- VARIABLES --- */
:root {
    --primary-red: #d32f2f;
    --primary-dark: #b71c1c;
    --accent-gold: #ffcc00;
    --bg-dark: #3e2723;
    --bg-gradient: linear-gradient(160deg, #3e2723, #5d4037);
    --text-white: #ffffff;
    --text-gray: #d7ccc8;
    --input-bg: rgba(255, 255, 255, 0.95);
}

/* --- Layout General --- */
.auth-container {
    display: flex;
    height: 100vh; /* Ocupa el 100% de la altura de la pantalla */
    width: 100%;
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg-dark);
    overflow: hidden; /* Evita que la p치gina entera tenga scroll */
}

/* --- Imagen (Izquierda) --- */
.auth-image {
    flex: 1.2;
    position: relative;
    overflow: hidden;
}
.auth-image img {
    width: 100%; height: 100%; object-fit: cover;
    filter: brightness(60%); transition: transform 8s ease;
}
.auth-image:hover img { transform: scale(1.1); }

.overlay-text {
    position: absolute; bottom: 60px; left: 60px;
    color: var(--text-white); z-index: 2;
    text-shadow: 2px 2px 10px rgba(0,0,0,0.7);
}
.overlay-text h2 { font-size: 3rem; margin-bottom: 0.5rem; font-weight: 700; }
.overlay-text span { color: var(--accent-gold); }
.overlay-text p { font-size: 1.3rem; opacity: 0.9; }

/* --- Panel Derecho (Formulario) --- */
.auth-form {
    flex: 1;
    background: var(--bg-gradient);
    position: relative;
    box-shadow: -10px 0 30px rgba(0,0,0,0.3);
    z-index: 10;
    
    /* CENTRADO */
    display: flex;
    justify-content: center;
    align-items: center; /* Esto centra verticalmente */
    
    /* Manejo de Scroll interno si la pantalla es muy peque침a */
    overflow-y: auto; 
}

/* --- Wrapper del Contenido --- */
.center-wrapper {
    width: 100%;
    /* Ancho ajustado para que no se vea "estirado" */
    max-width: 500px; 
    padding: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Header */
.auth-header { width: 100%; text-align: center; margin-bottom: 1.5rem; }
.logo { font-family: 'Georgia', serif; font-size: 2.5rem; color: var(--text-white); margin-bottom: 0.2rem; }
.logo span { color: var(--accent-gold); }
.subtitle { color: var(--text-gray); font-size: 0.95rem; margin-bottom: 1rem; }

/* Tabs */
.tabs {
    display: flex;
    background: rgba(0,0,0,0.2);
    border-radius: 40px;
    padding: 4px;
    margin: 0 auto;
    width: 100%; 
    max-width: 380px;
}
.tab {
    flex: 1; text-align: center; padding: 10px;
    font-size: 0.9rem; color: #bcaaa4; text-decoration: none;
    border-radius: 35px; transition: all 0.3s ease; cursor: pointer;
}
.tab.active {
    background-color: var(--accent-gold); color: #3e2723;
    font-weight: bold; box-shadow: 0 2px 10px rgba(255, 204, 0, 0.3);
}
.tab:hover:not(.active) { color: white; }

/* Form Content */
.form-content {
    width: 100%;
    display: flex;
    flex-direction: column;
    /* Reduje el espacio entre inputs para que quepan mejor */
    gap: 1rem; 
}

.form-group { position: relative; }

/* --- CORRECCI칍N DE ICONOS --- */
.input-icon {
    position: absolute;
    left: 16px;
    /* CAMBIO IMPORTANTE: Usamos px fijos en vez de 50% */
    top: 25px; 
    transform: translateY(-50%);
    color: #8d6e63;
    font-size: 1.1rem;
    transition: color 0.3s;
    z-index: 1;
}


.form-group textarea ~ .input-icon { 
    top: 28px; 
    transform: none; 
}

/* --- INPUTS OPTIMIZADOS --- */
/* He reducido el padding de 20px a 14px. 
   Siguen vi칠ndose "gorditos" pero ocupan menos altura total */
.form-group input {
    width: 100%;
    padding: 14px 14px 14px 45px; 
    border-radius: 12px;
    border: 2px solid transparent;
    background: var(--input-bg);
    color: #333;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem; /* Letra ligeramente m치s peque침a para balancear */
    transition: all 0.3s ease;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.form-group input:focus {
    outline: none; border-color: var(--accent-gold); background: #fff;
    transform: translateY(-2px); box-shadow: 0 8px 15px rgba(0,0,0,0.2);
}
.form-group input:focus + .input-icon { color: var(--primary-red); }

/* Error message */
.error-message {
    color: #ff8a80; font-size: 0.8rem; margin-top: 4px; margin-left: 10px;
    display: none; font-weight: 500;
}
.error-field { border-color: #ef5350 !important; }

/* Bot칩n */
.btn-submit {
    width: 100%;
    background: linear-gradient(135deg, var(--primary-red), var(--primary-dark));
    color: #fff;
    padding: 14px; /* Reducido ligeramente para ajustar */
    border-radius: 40px;
    font-weight: 700;
    font-size: 1.1rem;
    border: none; cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 6px 15px rgba(183, 28, 28, 0.4);
    margin-top: 10px;
}
.btn-submit:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(183, 28, 28, 0.6); }


/* --- MEDIA QUERY PARA LAPTOPS (Ajuste Fino) --- */
/* Si la altura de la pantalla es menor a 800px (laptop com칰n), compactamos un poco m치s */
@media (min-width: 901px) and (max-height: 800px) {
    .logo { font-size: 2rem; margin-bottom: 0; }
    .auth-header { margin-bottom: 1rem; }
    .form-content { gap: 0.8rem; } /* Menos espacio entre inputs */
    .form-group input { padding: 12px 12px 12px 45px; font-size: 0.9rem; }
    .btn-submit { padding: 12px; margin-top: 5px; }
}

/* --- RESPONSIVE M칍VIL --- */
@media (max-width: 900px) {
    .auth-container { flex-direction: column; }
    .auth-image { flex: none; height: 25vh; min-height: 180px; }
    .overlay-text { bottom: 15px; left: 20px; }
    .overlay-text h2 { font-size: 2rem; }
    .overlay-text p { display: none; }

    .auth-form {
        flex: 1; height: 75vh;
        display: block; /* Flow normal en m칩vil */
        border-radius: 30px 30px 0 0;
        margin-top: -25px;
    }
    .center-wrapper { padding: 1.5rem 1.5rem 3rem; max-width: 100%; }
    .logo { font-size: 2rem; }
}

/* --- Modal --- */
.modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(3px); animation: fadeIn 0.3s; }
.modal-content { background-color: #fff; margin: 15% auto; width: 90%; max-width: 400px; border-radius: 15px; overflow: hidden; animation: slideIn 0.3s; }
.modal-header { background: linear-gradient(135deg, var(--primary-dark), var(--primary-red)); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
.modal-header h2 { margin: 0; font-size: 1.2rem; }
.close { font-size: 24px; cursor: pointer; }
.modal-body { padding: 20px; color: #333; text-align: center; }
.btn-save { background: var(--primary-red); color: white; border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer; margin-top: 15px; font-weight: bold; }
@keyframes slideIn { from {transform: translateY(-20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
@keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
@keyframes shake { 0%, 100% {transform: translateX(0);} 25%, 75% {transform: translateX(-5px);} 50% {transform: translateX(5px);} }
</style>

<script>
// (Aqu칤 va tu mismo script de validaci칩n que ya ten칤as)
// Copia el script de validaci칩n de la versi칩n anterior aqu칤.
// Es el mismo c칩digo JavaScript, no cambia nada.
// --- L칍GICA DE VALIDACI칍N ---

function showCustomAlert(title, message, confirmCallback = null) {
    document.getElementById('alertTitle').textContent = title;
    document.getElementById('alertMessage').textContent = message;
    document.getElementById('customAlert').style.display = 'block';
    const confirmBtn = document.getElementById('alertConfirmBtn');
    const newBtn = confirmBtn.cloneNode(true);
    confirmBtn.parentNode.replaceChild(newBtn, confirmBtn);
    if (confirmCallback) {
        newBtn.onclick = function() { confirmCallback(); closeCustomAlert(); };
    } else { newBtn.onclick = closeCustomAlert; }
}
function closeCustomAlert() { document.getElementById('customAlert').style.display = 'none'; }
function showError(input, errorElement, message) {
    input.classList.add('error-field'); errorElement.textContent = message; errorElement.style.display = 'block';
    input.style.animation = "shake 0.3s"; setTimeout(() => input.style.animation = "", 300);
}
function hideError(input, errorElement) { input.classList.remove('error-field'); errorElement.style.display = 'none'; }
function clearAllErrors() { document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none'); document.querySelectorAll('.error-field').forEach(el => el.classList.remove('error-field')); }

function validateName(input) {
    const val = input.value.trim(); const errorEl = document.getElementById('nombreError'); const regex = /^[A-Za-z츼치칄칠칈칤칍칩칔칰칌침\s]+$/;
    if (!val) return showError(input, errorEl, 'El nombre es obligatorio');
    if (val.length < 3) return showError(input, errorEl, 'M칤nimo 3 caracteres');
    if (!regex.test(val)) return showError(input, errorEl, 'Solo se permiten letras');
    hideError(input, errorEl); return true;
}
function validateEmail(input) {
    const val = input.value.trim(); const errorEl = document.getElementById('emailError'); const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!val) return showError(input, errorEl, 'El correo es obligatorio');
    if (!regex.test(val)) return showError(input, errorEl, 'Formato de correo inv치lido');
    hideError(input, errorEl); return true;
}
function validatePhone(input) {
    const val = input.value.trim(); const errorEl = document.getElementById('telefonoError');
    if (!val) { hideError(input, errorEl); return true; }
    const regex = /^\d{4}-?\d{4}$/;
    if (!regex.test(val)) return showError(input, errorEl, 'Formato sugerido: 1234-5678');
    hideError(input, errorEl); return true;
}
function validatePass1(input) {
    const val = input.value; const errorEl = document.getElementById('password1Error');
    if (!val) return showError(input, errorEl, 'La contrase침a es requerida');
    if (val.length < 8) return showError(input, errorEl, 'M칤nimo 8 caracteres');
    hideError(input, errorEl); return true;
}
function validatePass2(input) {
    const val = input.value; const pass1 = document.getElementById('password1').value; const errorEl = document.getElementById('password2Error');
    if (!val) return showError(input, errorEl, 'Confirma tu contrase침a');
    if (val !== pass1) return showError(input, errorEl, 'Las contrase침as no coinciden');
    hideError(input, errorEl); return true;
}
function formatPhone(input) {
    let val = input.value.replace(/\D/g, '');
    if (val.length > 4) val = val.substring(0, 4) + '-' + val.substring(4, 8);
    input.value = val;
}

document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('registerForm');
    if(form) {
        document.getElementById('nombre').addEventListener('blur', function() { validateName(this); });
        document.getElementById('email').addEventListener('blur', function() { validateEmail(this); });
        document.getElementById('password1').addEventListener('blur', function() { validatePass1(this); });
        document.getElementById('password2').addEventListener('blur', function() { validatePass2(this); });
        const telInput = document.getElementById('telefono');
        telInput.addEventListener('input', function() { formatPhone(this); });
        telInput.addEventListener('blur', function() { validatePhone(this); });
        form.addEventListener('submit', function(e) {
            clearAllErrors();
            let isValid = true;
            if(!validateName(document.getElementById('nombre'))) isValid = false;
            if(!validateEmail(document.getElementById('email'))) isValid = false;
            if(!validatePhone(document.getElementById('telefono'))) isValid = false;
            if(!validatePass1(document.getElementById('password1'))) isValid = false;
            if(!validatePass2(document.getElementById('password2'))) isValid = false;
            if (!isValid) { e.preventDefault(); showCustomAlert('춰Atenci칩n!', 'Por favor revisa los campos marcados en rojo.'); }
        });
    }
});
window.onclick = function(event) { if (event.target == document.getElementById('customAlert')) closeCustomAlert(); }
</script>
{% endblock %}